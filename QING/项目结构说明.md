# DrawConnect 项目结构说明

## 📁 完整目录结构

```
DrawConnect/
│
├── 📱 app/                                          # Android 应用主目录
│   ├── src/main/
│   │   ├── java/com/drawconnect/
│   │   │   │
│   │   │   ├── 💾 data/                            # 数据层
│   │   │   │   ├── local/                          # 本地数据存储
│   │   │   │   │   ├── dao/                        # 数据访问对象
│   │   │   │   │   │   ├── ArtworkDao.kt          # 作品数据访问
│   │   │   │   │   │   └── UserDao.kt             # 用户数据访问
│   │   │   │   │   ├── entity/                     # 数据库实体
│   │   │   │   │   │   └── Entities.kt            # 实体定义
│   │   │   │   │   └── DrawConnectDatabase.kt     # 数据库配置
│   │   │   │   │
│   │   │   │   ├── remote/                         # 远程API
│   │   │   │   │   ├── api/                        # API接口定义
│   │   │   │   │   │   ├── AuthApi.kt             # 认证API
│   │   │   │   │   │   └── CloudApi.kt            # 云端API
│   │   │   │   │   └── dto/                        # 数据传输对象
│   │   │   │   │       └── Dtos.kt                # DTO定义
│   │   │   │   │
│   │   │   │   └── repository/                     # 仓库层
│   │   │   │       └── ArtworkRepository.kt       # 作品仓库
│   │   │   │
│   │   │   ├── 🎯 domain/                          # 领域层
│   │   │   │   └── model/                          # 领域模型
│   │   │   │       ├── DrawingModels.kt           # 绘图模型
│   │   │   │       └── UserModels.kt              # 用户模型
│   │   │   │
│   │   │   ├── 🎨 ui/                              # UI层
│   │   │   │   ├── auth/                           # 认证界面
│   │   │   │   │   ├── AuthViewModel.kt           # 认证ViewModel
│   │   │   │   │   └── LoginScreen.kt             # 登录界面
│   │   │   │   │
│   │   │   │   ├── canvas/                         # 绘图界面
│   │   │   │   │   ├── ColorPickerDialog.kt       # 颜色选择器
│   │   │   │   │   ├── DrawingCanvas.kt           # 绘图画布
│   │   │   │   │   ├── DrawingScreen.kt           # 绘图主界面
│   │   │   │   │   └── DrawingViewModel.kt        # 绘图ViewModel
│   │   │   │   │
│   │   │   │   ├── navigation/                     # 导航
│   │   │   │   │   └── Navigation.kt              # 导航配置
│   │   │   │   │
│   │   │   │   └── theme/                          # 主题
│   │   │   │       ├── Color.kt                    # 颜色定义
│   │   │   │       ├── Theme.kt                    # 主题配置
│   │   │   │       └── Type.kt                     # 字体配置
│   │   │   │
│   │   │   ├── 💉 di/                              # 依赖注入
│   │   │   │   ├── DatabaseModule.kt              # 数据库模块
│   │   │   │   └── NetworkModule.kt               # 网络模块
│   │   │   │
│   │   │   ├── DrawConnectApplication.kt          # 应用入口
│   │   │   └── MainActivity.kt                     # 主Activity
│   │   │
│   │   ├── res/                                     # 资源文件
│   │   │   └── values/
│   │   │       └── strings.xml                     # 字符串资源
│   │   │
│   │   └── AndroidManifest.xml                     # 应用清单
│   │
│   └── build.gradle.kts                            # 应用构建配置
│
├── 🖥️ backend/                                      # 后端服务
│   ├── models/                                      # 数据模型
│   │   ├── Artwork.js                              # 作品模型
│   │   └── User.js                                 # 用户模型
│   │
│   ├── routes/                                      # 路由
│   │   ├── auth.js                                 # 认证路由
│   │   └── cloud.js                                # 云端路由
│   │
│   ├── uploads/                                     # 上传文件目录
│   ├── server.js                                    # 服务器入口
│   ├── package.json                                # 依赖配置
│   ├── .env.example                                # 环境变量示例
│   └── README.md                                   # 后端文档
│
├── 📄 配置文件
│   ├── build.gradle.kts                            # 项目构建配置
│   ├── settings.gradle.kts                         # 项目设置
│   └── .gitignore                                  # Git忽略文件
│
└── 📚 文档
    ├── README.md                                    # 项目主文档
    ├── 快速启动指南.md                              # 快速启动
    ├── 第一阶段完成总结.md                          # 阶段总结
    └── 项目结构说明.md                              # 本文件
```

## 📊 文件统计

### Android 客户端 (Kotlin)
- **总文件数**: 25个 Kotlin 文件
- **代码行数**: 约 2500+ 行

#### 按模块分类:
- 数据层 (data): 9个文件
  - 本地存储: 4个文件
  - 远程API: 3个文件
  - 仓库: 2个文件
- 领域层 (domain): 2个文件
- UI层 (ui): 11个文件
  - 认证: 2个文件
  - 绘图: 4个文件
  - 导航: 1个文件
  - 主题: 3个文件
  - 其他: 1个文件
- 依赖注入 (di): 2个文件
- 应用入口: 2个文件

### 后端服务 (Node.js)
- **总文件数**: 5个 JavaScript 文件
- **代码行数**: 约 500+ 行

#### 按模块分类:
- 模型 (models): 2个文件
- 路由 (routes): 2个文件
- 服务器: 1个文件

### 配置和文档
- Gradle 配置: 3个文件
- Android 配置: 2个文件
- 文档: 4个 Markdown 文件

## 🔑 核心文件说明

### Android 核心文件

#### 1. DrawingCanvas.kt
- **作用**: 核心绘图引擎
- **功能**:
  - 处理触摸事件
  - 渲染绘图路径
  - 实时显示绘画内容

#### 2. DrawingViewModel.kt
- **作用**: 绘图状态管理
- **功能**:
  - 管理画布状态
  - 处理工具切换
  - 撤销/重做逻辑
  - 保存/加载作品

#### 3. ArtworkRepository.kt
- **作用**: 作品数据管理
- **功能**:
  - 本地保存作品
  - 加载作品数据
  - JSON序列化/反序列化

#### 4. DrawConnectDatabase.kt
- **作用**: 数据库配置
- **功能**:
  - Room数据库初始化
  - DAO提供

### 后端核心文件

#### 1. server.js
- **作用**: 服务器入口
- **功能**:
  - Express服务器配置
  - 中间件设置
  - 路由注册

#### 2. auth.js
- **作用**: 认证路由
- **功能**:
  - 用户注册
  - 用户登录
  - JWT生成

#### 3. cloud.js
- **作用**: 云端存储路由
- **功能**:
  - 文件上传
  - 作品管理
  - 数据查询

## 🏗️ 架构模式

### MVVM 架构
```
View (Composable)
    ↕️
ViewModel (StateFlow)
    ↕️
Repository
    ↕️
Data Source (Room / Retrofit)
```

### Clean Architecture 分层
```
┌─────────────────────────────────┐
│     UI Layer (Presentation)      │  ← Compose UI, ViewModels
├─────────────────────────────────┤
│     Domain Layer (Business)      │  ← Models, Use Cases
├─────────────────────────────────┤
│     Data Layer (Repository)      │  ← Repository Pattern
├─────────────────────────────────┤
│  Data Sources (Local & Remote)  │  ← Room, Retrofit
└─────────────────────────────────┘
```

## 🔄 数据流

### 绘图数据流
```
用户触摸 → DrawingCanvas → DrawingViewModel
→ CanvasState → 重新渲染 Canvas
```

### 保存数据流
```
DrawingViewModel → ArtworkRepository
→ Room Database + File System
```

### 认证数据流
```
LoginScreen → AuthViewModel → AuthApi
→ Backend → MongoDB → JWT Token
```

## 📦 依赖关系

### Android 主要依赖
- Jetpack Compose: UI框架
- Hilt: 依赖注入
- Room: 本地数据库
- Retrofit: 网络请求
- Kotlin Coroutines: 异步编程

### 后端主要依赖
- Express: Web框架
- Mongoose: MongoDB ORM
- JWT: 认证
- Multer: 文件上传
- bcryptjs: 密码加密

## 🎯 设计原则

1. **单一职责**: 每个类只负责一个功能
2. **依赖倒置**: 依赖抽象而非具体实现
3. **开闭原则**: 对扩展开放,对修改关闭
4. **接口隔离**: 使用小而专的接口

## 📈 可扩展性

### 易于扩展的部分
- ✅ 添加新的绘图工具
- ✅ 添加新的API端点
- ✅ 添加新的UI界面
- ✅ 添加新的数据模型

### 需要重构的部分
- ⚠️ 填充工具算法
- ⚠️ 选择工具实现
- ⚠️ 图片导出功能
- ⚠️ 缩略图生成

---

**文档版本**: v1.0
**最后更新**: 2026-01-14